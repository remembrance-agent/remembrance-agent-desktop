#!/bin/sh

# Source: https://superuser.com/questions/912955/how-to-make-a-java-jar-file-to-be-a-single-file-executable

JAR_PATH="./build/libs/remembrance-agent-v$VERSION-all.jar"
STUB_PATH="./bin/_stub"
RA_PATH="./bin/ra"

echo ">>> BUILDING WITH GRADLE"
./gradlew build --stacktrace

echo ">>> BUILDING ra FILE"
cat $STUB_PATH $JAR_PATH > $RA_PATH
chmod +x $RA_PATH

echo ">>> DONE"

# SEE https://docs.oracle.com/javase/8/docs/technotes/tools/unix/javapackager.html

JAVA_HOME=`C:\Program Files\Java\jdk1.8.0_241`
APP_DIR_NAME=ra.exe

#-deploy -Bruntime=/Library/Java/JavaVirtualMachines/jdk1.8.0_131.jdk/Contents/Home \
javapackager \
  -deploy -Bruntime=${JAVA_HOME} \
  -native image \
  -srcdir . \
  -srcfiles build/libs/remembrance-agent-desktop-v2.0.0-all.jar \
  -outdir release \
  -outfile ${APP_DIR_NAME} \
  -appclass io.p13i.ra.RemebranceAgentClient \
  -name "RemebranceAgent" \
  -title "RemebranceAgent" \
  -nosign \
  -v

echo ""
echo "If that succeeded, it created \"release/bundles/${APP_DIR_NAME}\""
