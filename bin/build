#!/bin/sh

# Exit on error
set -e

if [ -z ${VERSION+x} ]; then
  echo "VERSION is not set. Set a VERSION value (x.y.z) before continuing.";
  exit 1
fi

printf ">>> BUILDING WITH GRADLE... "
./gradlew build --stacktrace 2>&1 >/dev/null

printf "done.\n"

JAR_PATH="./build/libs/remembrance-agent-desktop-v${VERSION}-all.jar"

printf ">>> JAR FILE WRITTEN TO %s\n" "${JAR_PATH}"

# SEE https://docs.oracle.com/javase/8/docs/technotes/tools/unix/javapackager.html

OUTDIR=build
OUTFILE=RemebranceAgentDesktop.exe

printf ">>> RUNNING javapackager... "

javapackager \
  -deploy \
  -Bruntime= \
  -BappVersion="${VERSION}" \
  -native exe \
  -srcdir . \
  -srcfiles "${JAR_PATH}" \
  -outdir ${OUTDIR} \
  -outfile ${OUTFILE} \
  -appclass io.p13i.ra.RemembranceAgentClient \
  -name "Remebrance Agent Desktop" \
  -title "Remebrance Agent Desktop" \
  -nosign \
  2>&1 >/dev/null

printf "done.\n"

echo ">>> EXE FILE WRITTEN TO ${OUTDIR}/bundles/${OUTFILE}"

echo ">>> SUCCESSFUL BUILD"
